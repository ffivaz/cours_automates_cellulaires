<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Formation en fête - Automates cellulaires simples - démonstration</title>

    <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro" rel="stylesheet">
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/style.css">

    <script src="js/jquery.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/functions.js"></script>

    <script>
        var oneD = function (initial, ratio) {
            this.cells = initial;

            this.draw = function (ctx, generation) {
                var i = 0;
                this.cells.forEach(function (pixel) {
                    if (pixel == 0) {
                        ctx.fillStyle = 'white';
                        ctx.fillRect(Math.floor(i * 20 * ratio) + 0.5, Math.floor(generation * 20 * ratio) + 0.5, Math.floor(17 * ratio), Math.floor(17* ratio));
                        ctx.strokeStyle = 'black';
                        ctx.strokeRect(Math.floor(i * 20 * ratio) + 0.5, Math.floor(generation * 20 * ratio) + 0.5, Math.floor(17 * ratio), Math.floor(17* ratio));
                    } else {
                        ctx.fillStyle = 'black';
                        ctx.fillRect(Math.floor(i * 20 * ratio) + 0.5, Math.floor(generation * 20 * ratio) + 0.5, Math.floor(17 * ratio), Math.floor(17* ratio));
                        ctx.strokeStyle = 'black';
                        ctx.strokeRect(Math.floor(i * 20 * ratio) + 0.5, Math.floor(generation * 20 * ratio) + 0.5, Math.floor(17 * ratio), Math.floor(17* ratio));
                    }
                    i++;
                });
            }
        };
    </script>
</head>
<body>
<div class="container">
    <div class="row">
        <div class="col-md-12">
            <h1>Automates cellulaires simples - demo</h1>
        </div>
        <div class="col-md-3">
            <h3>Menu</h3>
            <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#myModal"
                    style="margin: 20px;">Aide
            </button>
            <div class="text-center" id="rules">
            </div>
            <div>
                <button class="btn btn-danger" id="startBtn" style="margin: 20px;">Dessiner</button>
            </div>
        </div>
        <div class="col-md-8">
            <h3>Canvas</h3>
            Zoom :
            <div class="btn-group" data-toggle="buttons" style="margin-bottom: 20px;">
                <button class="btn btn-primary active" id="zoom1">1x</button>
                <button class="btn btn-primary" id="zoom2">2x</button>
            </div>
            <canvas id="canvas" width="800" height="600"></canvas>
        </div>
    </div>
</div>
<script>

    var t = 55;
    var ratio = 0.5;
    var myCells = [];

    for (var i=1; i<=73;i++) {
        if (i == 37) {
            myCells.push(1);
        } else {
            myCells.push(0);
        }
    }

    var z1 = document.getElementById('zoom1');
    var z2 = document.getElementById('zoom2');

    z1.addEventListener('click', function () {
        t = 55;
        ratio = 0.5;
        z1.className += ' active';
        z2.className = 'btn btn-primary';
        for (var i=1; i<=73;i++) {
            if (i == 37) {
                myCells.push(1);
            } else {
                myCells.push(0);
            }
        }
    });

    z2.addEventListener('click', function () {
        t = 25;
        ratio = 1;
        z2.className += ' active';
        z1.className = 'btn btn-primary';
        myCells = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
    });



    var myRules = [
        {
            n: 'rule1',
            a: [1, 1, 1],
            b: 0
        },
        {
            n: 'rule2',
            a: [1, 1, 0],
            b: 1
        },
        {
            n: 'rule3',
            a: [1, 0, 1],
            b: 0
        },
        {
            n: 'rule4',
            a: [1, 0, 0],
            b: 1
        },
        {
            n: 'rule5',
            a: [0, 1, 1],
            b: 1
        },
        {
            n: 'rule6',
            a: [0, 1, 0],
            b: 0
        },
        {
            n: 'rule7',
            a: [0, 0, 1],
            b: 1
        },
        {
            n: 'rule8',
            a: [0, 0, 0],
            b: 0
        }
    ];

    var eDraw = function (e) {
        var myRule = e.a;
        var myTarget = e.b;

        var canvas = document.getElementById(e.n);
        var ctx = canvas.getContext("2d");
        var rule = new oneD(myRule, 1);
        rule.draw(ctx, 0);
        if (myTarget == 1) {
            ctx.fillStyle = 'black';
            ctx.fillRect(20.5, 20.5, 17, 17);
            ctx.strokeStyle = 'black';
            ctx.strokeRect(20.5, 20.5, 17, 17);
        } else {
            ctx.fillStyle = 'white';
            ctx.fillRect(20.5, 20.5, 17, 17);
            ctx.strokeStyle = 'black';
            ctx.strokeRect(20.5, 20.5, 17, 17);
        }
    };

    myRules.forEach(function (element) {

        var d = document.createElement('div');
        d.className += ' flex-container';
        document.getElementById('rules').appendChild(d);

        var e = document.createElement('canvas');
        e.width = "60";
        e.height = "40";
        e.style.padding = '5px';
        e.style.margin = '5px';
        e.style.border = '1px solid black';
        e.id = element.n;
        e.className += 'flex-items';
        d.appendChild(e);

        eDraw(element);

        var s = document.createElement('button');
        s.innerHTML = "changer";
        s.style.height = '20px;';
        s.className += "btn btn-warning flex-items";
        d.appendChild(s);
        s.addEventListener('click', function (e) {
            if (element.b == 1) {
                element.b = 0;
                eDraw(element);
            } else {
                element.b = 1;
                eDraw(element);
            }
        });
    });

    document.getElementById('startBtn').addEventListener('click', function () {

        var demo6 = new oneD(myCells, ratio);

        var canvas = document.getElementById('canvas');
        var ctx = canvas.getContext("2d");
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        demo6.draw(ctx, 0);

        var calcNG = function (init) {
            var nextGen = [];
            nextGen.push(0);
            for (var i = 1; i < init.length - 1; i++) {
                var a = init[i - 1];
                var b = init[i];
                var c = init[i + 1];
                myRules.forEach(function (element) {
                    if ([a, b, c].equals(element.a)) {
                        nextGen.push(element.b);
                    }
                });
            }
            nextGen.push(0);
            return nextGen;
        };

        var demoX = new oneD(myNextGen = calcNG(myCells), ratio);
        demoX.draw(ctx, 1);

        for (var i = 2; i < t; i++) {
            demoX = new oneD(myNextGen = calcNG(myNextGen), ratio);
            demoX.draw(ctx, i);
        }
    });

</script>

<div class="modal fade" tabindex="-1" role="dialog" id="myModal">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                        aria-hidden="true">&times;</span></button>
                <h4 class="modal-title">Aide</h4>
            </div>
            <div class="modal-body">
                <p>Dans le menu, vous pouvez changer la couleur du pixel de la génération suivante, pour chacun des
                    triplets. Lorsque vous avez fait vos choix, vous pouvez dessiner le résultat en choisissant le
                    bouton "Dessiner". Vous pouvez ensuite changer les paramètres et redessiner un nouvel automate.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Fermer</button>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div><!-- /.modal -->

</body>
</html>