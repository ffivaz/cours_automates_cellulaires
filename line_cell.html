<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Formation en fête - Automates cellulaires simples - démonstration</title>

    <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro" rel="stylesheet">
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/style.css">

    <script src="js/jquery.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/functions.js"></script>

    <script>
        var oneD = function (initial) {
            this.cells = initial;

            this.draw = function (ctx, generation) {
                var i = 0;
                this.cells.forEach(function (pixel) {
                    if (pixel == 0) {
                        ctx.strokeStyle = 'black';
                        ctx.strokeRect((i * 20) + 0.5, (generation * 20) + 0.5, 17, 17);
                    } else {
                        ctx.strokeStyle = 'black';
                        ctx.strokeRect((i * 20) + 0.5, + (generation * 20) + 0.5, 17, 17);
                        ctx.fillStyle = 'black';
                        ctx.fillRect(i * 20 + 0.5, (generation * 20) + 0.5, 17, 17);
                    }
                    i++;
                });
            }
        };
    </script>
</head>
<body>
<div class="container">
    <div class="row">
        <div class="col-md-12">
            <h1>Automates cellulaires simples - demo</h1>
        </div>
        <div class="col-md-2">
            <h3>Menu</h3>
            <div class="text-center" id="rules" class="flex-container">
            </div>
        </div>
        <div class="col-md-8">
            <canvas id="canvas" width="800" height="600"></canvas>
        </div>
    </div>
</div>
<script>

    var myCells = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];

    var myRules = [
        {
            a: [1, 1, 1],
            b: 0
        },
        {
            a: [1, 1, 0],
            b: 1
        },
        {
            a: [1, 0, 1],
            b: 0
        },
        {
            a: [1, 0, 0],
            b: 1
        },
        {
            a: [0, 1, 1],
            b: 1
        },
        {
            a: [0, 1, 0],
            b: 0
        },
        {
            a: [0, 0, 1],
            b: 1
        },
        {
            a: [0, 0, 0],
            b: 0
        }
    ];

    var i = 1;

    myRules.forEach(function (element) {
        //var d = document.createElement('div');
        //d.className += ' flex-items';
        //document.getElementById('rules').appendChild(d);

        var e = document.createElement('canvas');
        e.width = "60";
        e.height = "40";
        e.style.padding = '5px';
        e.style.margin = '5px';
        e.style.border = '1px solid black';
        e.id = "rule" + i;
        e.className += ' flex-items';
        document.getElementById('rules').appendChild(e);

        var s = document.createElement('button');
        s.innerHTML = "change";
        s.className += " btn btn-warning flex-items";
        document.getElementById('rules').appendChild(s);

        var myRule = element.a;
        var myTarget = element.b;

        var canvas = document.getElementById('rule' + i);
        var ctx = canvas.getContext("2d");
        var rule = new oneD(myRule);
        rule.draw(ctx, 0);
        if (myTarget == 1) {
            ctx.strokeStyle = 'black';
            ctx.strokeRect((1 * 20) + 0.5, 20.5, 17, 17);
            ctx.fillStyle = 'black';
            ctx.fillRect(1 * 20 + 0.5, 20.5, 17, 17);
        } else {
            ctx.strokeStyle = 'black';
            ctx.strokeRect((1 * 20) + 0.5, 20.5, 17, 17);
        }
        i++;
    });

    var demo6 = new oneD(myCells);

    var canvas = document.getElementById('demo6');
    var ctx = canvas.getContext("2d");

    demo6.draw(ctx, 0);

    var calcNG = function (init) {
        var nextGen = [];
        nextGen.push(0);
        for (var i = 1; i < init.length-1; i++) {
            var a = init[i - 1];
            var b = init[i];
            var c = init[i + 1];
            myRules.forEach(function (element) {
                if ([a,b,c].equals(element.a)) {
                    nextGen.push(element.b);
                }
            });
        }
        nextGen.push(0);
        return nextGen;
    };

    var demoX = new oneD(myNextGen = calcNG(myCells));
    demoX.draw(ctx, 1);

    for (var i = 2; i < 15; i++) {
        var demoX = new oneD(myNextGen = calcNG(myNextGen));
        demoX.draw(ctx, i);
    }
</script>

</body>
</html>