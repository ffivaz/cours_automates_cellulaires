<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Formation en fête - Automates cellulaires simples - démonstration</title>

    <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro" rel="stylesheet">
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/style.css">

    <script src="js/jquery.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/functions.js"></script>
    <script src="js/rules.js"></script>

    <script>

    </script>
</head>
<body>
<div class="container">
    <div class="row">
        <div class="col-md-12">
            <h2>Jeu de la vie (Conway) - demo</h2>
        </div>
        <div class="col-md-3">
            <h4>Menu</h4>
            <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#myModal"
                    style="margin: 20px;">Aide
            </button>
            <div class="text-center" id="rules">
            </div>
            <div>
                <button class="btn btn-danger hidden" id="startBtn" style="margin: 20px;">Dessiner</button>
            </div>
        </div>
        <div class="col-md-8">
            <h4>Canvas</h4>
            <canvas id="canvas" width="800" height="500"></canvas>
        </div>
    </div>
</div>
<script>

    /**
     * Creates an array fo arrays for the data
     **/
    var createArray = function () {

        /**
         * Creates an array for the lines. Using a function is important to avoid linking the lines.
         **/
        var createLine = function () {
            var someLine = [];

            var i = 0;
            while (i < 72) {
                someLine.push(0);
                i++;
            }

            return someLine;
        };

        var nCol = 40;
        var someCells = [];
        for (var i = 0; i < nCol; i++) {
            someCells.push(createLine());
        }

        return someCells;
    };

    /**
     * Draws (or redraws) the canvas from a array of arrays (cells)
     **/
    var canvasDraw = function (cells, context) {
        var col = 0;
        var ratio = 0.5;
        cells.forEach(function (line) {
            var i = 0;
            line.forEach(function (pixel) {
                if (pixel == 0) {
                    context.fillStyle = 'white';
                    context.fillRect(Math.floor(i * 20 * ratio) + 0.5, Math.floor(col * 20 * ratio) + 0.5, Math.floor(17 * ratio), Math.floor(17 * ratio));
                    context.strokeStyle = 'black';
                    context.strokeRect(Math.floor(i * 20 * ratio) + 0.5, Math.floor(col * 20 * ratio) + 0.5, Math.floor(17 * ratio), Math.floor(17 * ratio));
                } else {
                    context.fillStyle = 'black';
                    context.fillRect(Math.floor(i * 20 * ratio) + 0.5, Math.floor(col * 20 * ratio) + 0.5, Math.floor(17 * ratio), Math.floor(17 * ratio));
                    context.strokeStyle = 'black';
                    context.strokeRect(Math.floor(i * 20 * ratio) + 0.5, Math.floor(col * 20 * ratio) + 0.5, Math.floor(17 * ratio), Math.floor(17 * ratio));
                }
                i++;
            });
            col++;
        });
    };

    /**
     * From Wikipedia, Game of Life rules are:
     * 1. Any live cell with fewer than two live neighbours dies, as if caused by under-population.
     * 2. Any live cell with two or three live neighbours lives on to the next generation.
     * 3. Any live cell with more than three live neighbours dies, as if by over-population.
     * 4. Any dead cell with exactly three live neighbours becomes a live cell, as if by reproduction.
     **/

    var nextGen = function (cells) {
        var cellsCopy = arrayClone(cells);
        var a = 0;
        for (var j = 1; j < cellsCopy.length - 1; j++) {
            for (var i = 1; i < cellsCopy[j].length - 1; i++) {
                a = 0;
                a = a + cellsCopy[j - 1][i - 1] + cellsCopy[j - 1][i] + cellsCopy[j - 1][i + 1];
                a = a + cellsCopy[j][i - 1] + cellsCopy[j][i + 1];
                a = a + cellsCopy[j + 1][i - 1] + cellsCopy[j + 1][i] + cellsCopy[j + 1][i + 1];
                if (cellsCopy[j][i] == 1 && a < 2) {
                    cells[j][i] = 0;
                }
                if (cellsCopy[j][i] == 1 && (a == 2 || a == 3)) {
                    cells[j][i] = 1;
                }
                if (cellsCopy[j][i] == 1 && a > 3) {
                    cells[j][i] = 0;
                }
                if (cellsCopy[j][i] == 0 && a == 3) {
                    cells[j][i] = 1;
                }
            }
        }
    };

    var init = function (type) {
        switch (type) {
            case 'blinker':
                myCells[20][35] = 1;
                myCells[20][36] = 1;
                myCells[20][37] = 1;
        }
    };

    var canvas = document.getElementById('canvas');
    var ctx = canvas.getContext("2d");

    var myCells = createArray();
    init('blinker');

    ctx.clearRect(0, 0, canvas.width, canvas.height); // Flush canvas
    canvasDraw(myCells, ctx);

    var t = 0;
    var timer = setInterval(function () {
        nextGen(myCells);
        ctx.clearRect(0, 0, canvas.width, canvas.height); // Flush canvas
        canvasDraw(myCells, ctx);
        t++;
    }, 500);

    if (t == 500) {
        clearInterval(timer);
    }

</script>

<div class="modal fade" tabindex="-1" role="dialog" id="myModal">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                        aria-hidden="true">&times;</span></button>
                <h4 class="modal-title">Aide</h4>
            </div>
            <div class="modal-body">
                <p>Dans le menu, en cliquant sur les boutons oranges, vous pouvez changer la couleur du pixel de la
                    génération suivante, pour chacun des
                    triplets. Lorsque vous avez fait vos choix, vous pouvez afficher le résultat en choisissant le
                    bouton "Dessiner". Vous pouvez ensuite changer les paramètres et redessiner un nouvel automate.</p>
                <p>Pour changer l'échelle, utilisez le zoom 1x (petits pixels) ou 2x (grands pixels), vous devez
                    également redessiner le canevas.</p>
                <p>Pour changer la ligne initiale, utilisez les boutons "standard" (une ligne de pixels blancs avec un
                    pixel noir au centre) ou "aléatoire" (chaque élément de la ligne initiale est choisi au hasard).
                    Pour changer la ligne en mode aléatoire, recliquez simplement sur "aléatoire". N'oubliez pas de
                    recliquez sur "Dessiner" pour afficher le résultat.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Fermer</button>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div><!-- /.modal -->

</body>
</html>